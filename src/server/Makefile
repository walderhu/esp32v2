
all: clean
	@ngrok http 8081 > ngrok.log 2>&1 &
	@echo "‚ñ∂ –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä..."
	@python server.py 


clean:
	@echo "üîπ –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–æ—Ä—Ç 8081..."
	@fuser -k 8081/tcp 2>/dev/null || true
	@sleep 0.5
	@# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Å—Ç–∞–ª–∏—Å—å –ª–∏ –ø—Ä–æ—Ü–µ—Å—Å—ã
	@while lsof -i tcp:8081 >/dev/null 2>&1; do \
		echo "–ü–æ—Ä—Ç 8081 –≤—Å—ë –µ—â—ë –∑–∞–Ω—è—Ç, —É–±–∏–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å..."; \
		pids=$$(lsof -ti tcp:8081); \
		[ -n "$$pids" ] && kill -9 $$pids; \
		sleep 0.2; \
	done
	@echo "‚úÖ –ü–æ—Ä—Ç 8081 —Å–≤–æ–±–æ–¥–µ–Ω"

# test:
# 	sudo ufw allow 8081/tcp
# 	ifconfig
# 	ip addr show eth0

# 	pip install pyngrok
# 	ngrok config add-authtoken 341CRwebVYMqowAL05AUXmqOMhD_5oZr9QAff1MsGWDCSuv7q
# 	ngrok http 8081
